!function(n,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("Dexie"));else if("function"==typeof define&&define.amd)define(["Dexie"],e);else{var t=e("object"==typeof exports?require("Dexie"):n.Dexie);for(var r in t)("object"==typeof exports?exports:n)[r]=t[r]}}(this,function(n){return function(n){function e(r){if(t[r])return t[r].exports;var u=t[r]={exports:{},id:r,loaded:!1};return n[r].call(u.exports,u,u.exports,e),u.loaded=!0,u.exports}var t={};return e.m=n,e.c=t,e.p="",e(0)}([function(n,e,t){var r=t(1),u=t(2),i=t(3),o=t(4),c=t(6),f=t(7),a=t(9),s=t(10),p=t(11),l=t(12),d=t(8),y={$eq:function(n,e){return function(t){return d(t,n)&&t[n]===e}},$gt:function(n,e){return function(t){return d(t,n)&&t[n]>e}},$gte:function(n,e){return function(t){return d(t,n)&&t[n]>=e}},$lt:function(n,e){return function(t){return d(t,n)&&t[n]<e}},$lte:function(n,e){return function(t){return d(t,n)&&t[n]<=e}},$ne:function(n,e){return function(t){return d(t,n)&&t[n]!==e}},$in:function(n,e){return function(t){return d(t,n)&&e.indexOf(t[n])>-1}},$nin:function(n,e){return function(t){return d(t,n)&&e.indexOf(t[n])===-1}},$exists:function(n,e){return function(t){return d(t,n)===e}},$all:function(n,e){return function(t){return d(t,n)&&e.every(function(e){return t[n].indexOf(e)>-1})}},$size:function(n,e){return function(t){return d(t,n)&&t[n].length===e}},$elemMatch:function(n,e){var t=k(n,e);return function(e){return d(e,n)&&e[n].some(function(e){var r={};return r[n]=e,t.every(function(n){return n(r)})})}},$not:function(n,e){var t=k(n,e);return function(e){return!d(e,n)||t.every(function(n){return!n(e)})}}},v={$and:function(n,e){var t=e.map(x).reduce(o);return function(n){return t.every(function(e){return e(n)})}},$or:function(n,e){var t=e.map(x);return function(n){return t.some(function(e){return e.every(function(e){return e(n)})})}},$nor:function(n,e){var t=this.$and(n,e);return function(n){return!t(n)}}},h={$inc:function(n,e){return $(e,function(n,t){d(t,n)&&(t[n]+=e[n])})},$mul:function(n,e){return $(e,function(n,t){d(t,n)&&(t[n]*=e[n])})},$rename:function(n,e){return $(e,function(n,t){var r=t[n];delete t[n],t[e[n]]=r})},$set:function(n,e){return $(e,function(n,t){t[n]=e[n]})},$unset:function(n,e){return $(e,function(n,e){delete e[n]})},$min:function(n,e){return $(e,function(n,t){t[n]=Math.min(t[n],e[n])})},$max:function(n,e){return $(e,function(n,t){t[n]=Math.max(t[n],e[n])})},$addToSet:function(n,e){return $(e,function(n,t){f(t,n)?t[n].indexOf(e[n])===-1&&t[n].push(e[n]):t[n]=[e[n]]})},$pop:function(n,e){return $(e,function(n,t){f(t,n),1===e[n]?t[n].pop():e[n]===-1&&t[n].shift()})},$push:function(n,e){return $(e,function(n,t){f(t,n)?t[n].push(e[n]):t[n]=[e[n]]})},$pullAll:function(n,e){return $(e,function(n,t){f(t,n);var r=e[n];t[n]=t[n].filter(function(n){return r.indexOf(n)===-1})})},$pull:function(n,e){return $(e,function(n,t){f(t,n);var r=e[n],u=s(r);if(u)t[n]=t[n].filter(function(n){return n!==r});else{var i=k(n,r);t[n]=t[n].filter(function(e){var t={};return t[n]=e,!i.some(function(n){return n(t)})})}})},$slice:function(n,e){return $(e,function(n,t){f(t,n);var r=e[n];if(s(r))t[n]=p(t[n],r);else{var u=Object.keys(r);t[n]=t[n].map(function(n){return u.reduce(function(n,e){return n[e]=p(n[e],r[e]),n},n)})}})},$sort:function(n,e){return $(e,function(n,t){f(t,n);var r=e[n];if(s(r))t[n]=t[n].sort(function(n,e){return c(n,e,r)});else{var u=t[n].slice();t[n]=Object.keys(r).reduce(function(n,e){var t=r[e];return u.sort(function(n,r){var u=n[e],i=r[e];return c(u,i,t)})},t[n])}})}},O={query:Object.keys(y),queryLogical:Object.keys(v),update:Object.keys(h)},b=["upsert"],m=["$set","$addToSet","$push"],x=function(n){return Object.keys(n).map(function(e){return k(e,n[e])}).reduce(o)},k=function(n,e){return Object.keys(e).map(function(t){return U({key:n,type:t,value:e[t]})})},j=function(n,e){var t=e||Object.keys(n);return function(e){return t.every(function(t){return d(e,t)&&e[t]===n[t]})}},g=function(n,e){var t=e||Object.keys(n);return function(e){t.forEach(function(t){d(e,t)&&(e[t]=n[t])})}},$=function(n,e){var t=Object.keys(n);return function(n){t.forEach(function(t){e(t,n)})}},q=function(n,e){var t=Object.keys(n).filter(function(n){var e=d(y,n),t=d(v,n);return!(e||t)}),r=u(n,t),o=m.reduce(function(n,t){var r=e[t];return i(n,r)},{});return i(r,o)},w=function(n,e){var t=-1,r=-1,u=-1;return e.indexedKeys.forEach(function(n,e){n.unique?t=e:"number"==typeof n.value?r=e:n.plain&&(u=e)}),t>-1?e.indexedKeys[t]:r>-1?e.indexedKeys[r]:e.indexedKeys[u]},K=function(n){return n.queryOperators.advanced.map(function(n){return n.operators.map(function(e){return U({type:e,key:n.key,value:n.value[e]})})}).reduce(o)},P=function(n){return n.updateOperators.advanced.map(function(n){return U({type:n.key,key:null,value:n.value})})},C=function(n){var e=K(n);return function(n){return e.every(function(e){return e(n)})}},T=function(n){var e=P(n);return function(n){e.forEach(function(e){e(n)})}},E=function(n){return n.queryOperators.plain.map(function(n){return n.key})},S={primaryKey:function(n,e,t){var r=e.primaryKey.key,u=e.primaryKey.value,i=t.where(r).equals(u);if(e.queryOperators.plain.length>0){var o=j(n,E(e));i.and(o)}if(e.queryOperators.advanced.length>0){var c=C(e);i.and(c)}return i},indexedProp:function(n,e,t){var r,u=w(n,e);if(r=u&&u.plain?t.where(u.key).equals(u.value):t.toCollection(),e.queryOperators.plain.length>0){var i=j(n,E(e));r.and(i)}if(e.queryOperators.advanced.length>0){var o=C(e);r.and(o)}return r},fullScan:function(n,e,t){var r=t.toCollection();if(e.queryOperators.plain.length>0){var u=j(n,E(e));r.and(u)}if(e.queryOperators.advanced.length>0){var i=C(e);r.and(i)}return r}},A=function(n,e){var t=e.updateOperators.plain.length>0,r=e.updateOperators.advanced.length>0;return t&&r?l:t?g(n,e.keys):r?T(e):void 0},I=function(n,e){return{insertedCount:1,insertedId:e.id,ops:[e.item],result:{ok:1,n:1}}},D=function(n,e){var t=e&&e.isUpsert===!0,r=t?0:n,u=t?1:0;return{result:{ok:1,nModified:r},modifiedCount:r,upsertedCount:u,upsertedId:t?e.id:null}},M=function(n){return{result:{ok:1,n:n},deletedCount:n}},L=function(n,e,t){return new r.Promise(function(u){return n.update(e,t).then(function(u){if(0===u.modifiedCount){var i=q(e,t);return n.insert(i)}return r.Promise.resolve(u)}).then(function(n){var e=n;return"number"==typeof n.insertedId&&(e=D(1,{isUpsert:!0,id:n.insertedId})),u(e)})})},N=function(n,e,t){var r=J(t),u=A(t,r);return n.find(e).modify(u).then(function(n){return D(n,null)})},U=function(n){var e;return O.query.indexOf(n.type)>-1?e=y:O.queryLogical.indexOf(n.type)>-1?e=v:O.update.indexOf(n.type)>-1&&(e=h),e[n.type](n.key,n.value)},z=function(n,e,t){return e.reduce(t(n,e),{plain:[],advanced:[]})},W=function(n){return function(e,t){var r=n[t],u=s(r),i=O.queryLogical.indexOf(t)>-1;if(u)e.plain.push({key:t,value:r,plain:u});else if(i){var o={};o[t]=r,e.advanced.push({key:t,value:o,plain:u,operators:[t]})}else e.advanced.push({key:t,value:r,plain:u,operators:Object.keys(r).filter(function(n){return O.query.indexOf(n)>-1})});return e}},Y=function(n){return function(e,t){var r=n[t],u=s(r);return u?e.plain.push({key:t,value:r,plain:u}):e.advanced.push({key:t,value:r,plain:u}),e}},_=function(n,e){return z(n,e,W)},B=function(n,e){return z(n,e,Y)},F=function(n,e){var t=e.primKey.keyPath,r=n[t],u=typeof r,i="number"===u||"string"===u;return i?{key:t,value:r}:{key:!1}},G=function(n,e,t){return t.indexes.filter(function(n){return e.indexOf(n.keyPath)>-1}).map(function(e){var t=e.keyPath;return{key:t,value:n[t],unique:e.unique,plain:s(n[t])}})},H=function(n,e){var t=Object.keys(n);return{keys:t,queryOperators:_(n,t),primaryKey:F(n,e),indexedKeys:G(n,t,e)}},J=function(n){var e=Object.keys(n);return{keys:e,updateOperators:B(n,e)}},Q=function(n){return a(n)?{}:u(n,b)},R=function(n,e){var t,r=H(n,e);return t=r.primaryKey.key?"primaryKey":r.indexedKeys.length>0?"indexedProp":"fullScan",{queryAnalysis:r,execute:S[t]}},V=function(n,e,t,r){var u=r.upsert===!0?L:N;return u(n,e,t)},X=function(n,e){if(a(e))return n.toCollection();var t=R(e,n.schema);return t.execute(e,t.queryAnalysis,n)},Z=function(n,e){var t=n.schema.primKey.keyPath;return n.add(e).then(function(n){var r=u(e,Object.keys(e));return r[t]=n,I(1,{item:e,id:n})})},nn=function(n,e){return X(n,e)["delete"]().then(M)},en=function(n){return n.toCollection()["delete"]().then(M)};r.addons.push(function(n){r.prototype.collection=function(e){return n.table(e)},n.Table.prototype.count=function(n){var e=a(n),t=e?this.toCollection():X(this,n);return t.count()},n.Table.prototype.find=function(n){return X(this,n)},n.Table.prototype.findOne=function(n){return X(this,n).first()},n.Table.prototype.insert=function(n){return Z(this,n)},n.Table.prototype.remove=function(n){return nn(this,n)},n.Table.prototype.drop=function(){return en(this)},n.WriteableTable.prototype.update=function e(n,e,t){var r=Q(t);return V(this,n,e,r)}})},function(e,t){e.exports=n},function(n,e){n.exports=function(n,e){return n=n||{},"string"==typeof e&&(e=e.split(/ +/)),e.reduce(function(e,t){return null==n[t]?e:(e[t]=n[t],e)},{})}},function(n,e){"use strict";function t(n){if(null===n||void 0===n)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}function r(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de","5"===Object.getOwnPropertyNames(n)[0])return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var r=Object.getOwnPropertyNames(e).map(function(n){return e[n]});if("0123456789"!==r.join(""))return!1;var u={};return"abcdefghijklmnopqrst".split("").forEach(function(n){u[n]=n}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},u)).join("")}catch(i){return!1}}var u=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;n.exports=r()?Object.assign:function(n,e){for(var r,o,c=t(n),f=1;f<arguments.length;f++){r=Object(arguments[f]);for(var a in r)u.call(r,a)&&(c[a]=r[a]);if(Object.getOwnPropertySymbols){o=Object.getOwnPropertySymbols(r);for(var s=0;s<o.length;s++)i.call(r,o[s])&&(c[o[s]]=r[o[s]])}}return c}},function(n,e,t){"use strict";function r(n,e){return n.concat(e)}var u=t(5);n.exports=u(r)},function(n,e){"use strict";function t(n,e){var t=function(){return arguments.length>1?n.call(e,arguments[0],arguments[1]):n.bind(e,arguments[0])};return t.uncurry=function(){return n},t}n.exports=t},function(n,e){"use strict";n.exports=function(n,e,t){return 1===t?n>e:n<e}},function(n,e,t){"use strict";var r=t(8);n.exports=function(n,e){var t=r(n,e),u=Array.isArray(n[e]);if(t&&!u)throw new Error("You can't use array update operator on non-array field");return t}},function(n,e){"use strict";n.exports=function(n,e){return n.hasOwnProperty(e)}},function(n,e){n.exports=function(n){var e="object"==typeof n&&null!==n,t=!(e&&n);return t||0===Object.keys(n).length}},function(n,e){"use strict";n.exports=function(n){var e=typeof n;return"number"===e||"string"===e||"boolean"===e}},function(n,e){"use strict";n.exports=function(n,e){return e>=0?n.slice(0,e):n.slice(e)}},function(n,e){n.exports=function(){}}])});